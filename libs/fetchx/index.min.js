export async function fetchy(t,e={}){let{method:a,base:o,query:h,body:c,headers:r={},timeout:n,creds:f=!1,type:s="json",retry:y=0,ok:d}=e,l=o?o.replace(/\/$/,"")+"/"+t.replace(/^\//,""):t;if(h){let i=new URLSearchParams;for(let u in h)null!=h[u]&&i.append(u,h[u]);l+=(l.includes("?")?"&":"?")+i.toString()}let p=n?new AbortController:null;n&&setTimeout(()=>p.abort(),n);let b={method:a||(c?"POST":"GET"),headers:{...r},signal:p?.signal,credentials:f?"include":"same-origin"};b.headers.Accept||="*/*",null!=c&&(c instanceof FormData?b.body=c:"object"==typeof c?(b.body=JSON.stringify(c),b.headers["Content-Type"]||="application/json"):b.body=c);try{let m=await fetch(l,b),T=d?d(m.status):m.status>=200&&m.status<300;if(!T)throw m;let w;return{data:w="text"===s?await m.text():"blob"===s?await m.blob():"buffer"===s?await m.arrayBuffer():await m.json(),code:m.status,msg:m.statusText,head:Object.fromEntries(m.headers.entries()),url:m.url}}catch(g){if(y>0)return fetchy(t,{...e,retry:y-1});throw g}}fetchy.get=(t,e)=>fetchy(t,{...e,method:"GET"}),fetchy.post=(t,e,a)=>fetchy(t,{...a,method:"POST",body:e}),fetchy.put=(t,e,a)=>fetchy(t,{...a,method:"PUT",body:e}),fetchy.patch=(t,e,a)=>fetchy(t,{...a,method:"PATCH",body:e}),fetchy.del=(t,e)=>fetchy(t,{...e,method:"DELETE"}),fetchy.head=(t,e)=>fetchy(t,{...e,method:"HEAD"}),fetchy.opt=(t,e)=>fetchy(t,{...e,method:"OPTIONS"});
